<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='searchresults.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <title>Search Results - RJ Cars</title>
</head>
<body>
    <!-- Hero Section (mini version) -->
    <section class="hero-mini">
        <div class="hero-content">
            <h1><span class="logo">RJ <span class="logo-accent">Cars</span></span></h1>
            <p>Search Results</p>
        </div>
    </section>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <ul class="nav-links">
                <li><a href="{{ url_for('homepage') }}">Home</a></li>
                <li><a href="{{ url_for('featuredCars') }}">Our Collection</a></li>
                <li><a href="{{ url_for('search') }}">Find Your Classic</a></li>
                <li><a href="{{ url_for('sellers') }}">Authorized Sellers</a></li>
            </ul>
        </div>
    </nav>

    <!-- Search Results Content -->
    <div class="container">
        <!-- Search Summary -->
        <div class="search-summary">
            <h2>Your Search Criteria</h2>
            <p>
                {% if search_params.brand %}Brand: <strong>{{ search_params.brand }}</strong>{% endif %}
                {% if search_params.model %}, Model: <strong>{{ search_params.model }}</strong>{% endif %}
                {% if search_params.year %}, Year: <strong>{{ search_params.year }}</strong>{% endif %}
                {% if search_params.price %}, Max Price: <strong>KSh {{ "{:,}".format(search_params.price) }}</strong>{% endif %}
                {% if search_params.mileage %}, Max Mileage: <strong>{{ "{:,}".format(search_params.mileage) }} km</strong>{% endif %}
                {% if search_params.condition %}, Condition: <strong>{{ search_params.condition|capitalize }}</strong>{% endif %}
                {% if search_params.location %}, Location: <strong>{{ search_params.location }}</strong>{% endif %}
            </p>
        </div>

        {% if results %}
            <!-- Results Count -->
            <div class="search-result-count">
                <h2>Found {{ results|length }} Exceptional Vehicles</h2>
            </div>
            
            <!-- Results Grid -->
            <div class="results-grid">
                {% for car in results %}
                    <div class="car-card">
                        <div class="car-image">
                            {% if car.image_url %}
                                <img src="{{ car.image_url }}" alt="{{ car.brand }} {{ car.model }}">
                            {% elif car.image_data %}
                                <img src="data:image/jpeg;base64,{{ car.image_data }}" alt="{{ car.brand }} {{ car.model }}">
                            {% elif car.image_path %}
                                {% if car.image_path.startswith('car-images/') %}
                                    <!-- Supabase Storage URL -->
                                    <img src="{{ config.SUPABASE_URL }}/storage/v1/object/public/{{ car.image_path }}" alt="{{ car.brand }} {{ car.model }}">
                                {% else %}
                                    <!-- Legacy static file -->
                                    <img src="{{ url_for('static', filename=car.image_path) }}" alt="{{ car.brand }} {{ car.model }}">
                                {% endif %}
                            {% else %}
                                <img src="{{ url_for('static', filename='images/default-car.jpg') }}" alt="Default car image">
                            {% endif %}
                        </div>
                        <div class="car-info">
                            <h3>{{ car.brand }} {{ car.model }} ({{ car.year }})</h3>
                            <span class="car-price">KSh {{ "{:,}".format(car.price) }}</span>
                            
                            <div class="car-details">
                                <p><strong>Mileage:</strong> <span>{{ "{:,}".format(car.mileage) }} km</span></p>
                                <p><strong>Condition:</strong> <span>{{ car.condition|capitalize }}</span></p>
                                <p><strong>Location:</strong> <span>{{ car.location }}</span></p>
                                <p><strong>Seller:</strong> <span>{{ car.seller_name }}</span></p>
                            </div>
                            
                            {% if car.description %}
                                <p class="car-description">{{ car.description }}</p>
                            {% endif %}
                            
                            <a href="tel:{{ car.seller_phone }}" class="contact-btn">
                                <i class="fas fa-phone"></i> Contact Seller
                            </a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <!-- No Results Found -->
            <div class="no-results">
                <h2>No Vehicles Found</h2>
                <p>We regret to inform you that no automobiles matching your criteria are currently available in our collection. Perhaps you might consider broadening your search parameters or consulting with our specialists for assistance.</p>
                <a href="{{ url_for('search') }}" class="btn contact-btn">Refine Your Search</a>
            </div>
        {% endif %}
    </div>

    <!-- Footer -->
    <footer class="footer">
        <span class="footer-logo">RJ <span class="logo-accent">Cars</span></span>
        <p>&copy; 2025 RJ Cars. All rights reserved. Purveyor of exceptional automobiles for the discerning collector.</p>
    </footer>
</body>
</html>